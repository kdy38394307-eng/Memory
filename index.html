<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Memory</title>
  <style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Arial', sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding-top: 100px;
}

.header {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 1000;
  text-align: center;
}

.header h1 {
  color: white;
  font-size: 2.5rem;
  text-shadow: 2px 2px 8px rgba(0,0,0,0.5);
  margin: 0;
  font-weight: 100;
  letter-spacing: 8px;
  font-family: 'Georgia', 'Times New Roman', serif;
  font-style: italic;
  text-transform: lowercase;
}

.container {
  background: white;
  padding: 2rem;
  border-radius: 15px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.2);
  text-align: center;
  max-width: 800px;
  width: 90%;
  min-height: 400px;
}

.main-menu {
  margin-bottom: 2rem;
}

.menu-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 30px;
  margin-bottom: 2rem;
}

.fortune-btn, .lotto-btn {
  border: none;
  padding: 0;
  border-radius: 20px;
  cursor: pointer;
  transition: all 0.3s ease;
  height: 150px;
  position: relative;
  overflow: hidden;
}

.fortune-btn {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.lotto-btn {
  background: linear-gradient(135deg, #ff6b6b 0%, #ffa500 100%);
}

.btn-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  color: white;
}

.btn-icon {
  font-size: 3rem;
  margin-bottom: 10px;
}

.btn-text {
  font-size: 1.2rem;
  font-weight: bold;
}

.back-button {
  margin-bottom: 1rem;
  text-align: left;
}

.back-button button {
  background: #6c757d;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 15px;
  cursor: pointer;
  font-size: 0.9rem;
}

button {
  background: #667eea;
  color: white;
  border: none;
  padding: 15px 30px;
  margin: 10px;
  border-radius: 25px;
  cursor: pointer;
  font-size: 1.1rem;
  transition: all 0.3s ease;
}

.fortune-btn:hover {
  transform: translateY(-5px);
  box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
}

.lotto-btn:hover {
  transform: translateY(-5px);
  box-shadow: 0 15px 35px rgba(255, 107, 107, 0.4);
}

.back-button button:hover {
  background: #5a6268;
}

button:hover {
  background: #764ba2;
  transform: translateY(-2px);
}

button:disabled {
  background: #ccc !important;
  color: #666 !important;
  cursor: not-allowed !important;
  transform: none !important;
  box-shadow: none !important;
}

button:disabled:hover {
  background: #ccc !important;
  transform: none !important;
}

.result-box {
  background: #f8f9fa;
  padding: 1.5rem;
  border-radius: 10px;
  border-left: 4px solid #667eea;
  font-size: 1.1rem;
  line-height: 1.6;
  color: #333;
  min-height: 200px;
  text-align: left;
}

.result-box.empty {
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  color: #999;
  font-style: italic;
}

.visitor-counter {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: rgba(255, 255, 255, 0.9);
  padding: 8px 12px;
  border-radius: 20px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  font-size: 0.9rem;
  color: #666;
  backdrop-filter: blur(10px);
}

.fortune-result {
  text-align: center;
  padding: 20px;
}

.fortune-text {
  font-size: 1.3rem;
  margin: 20px 0;
  color: #333;
}

.fortune-date {
  color: #666;
  font-size: 0.9rem;
}

.lotto-result {
  text-align: center;
  padding: 20px;
}

.lotto-numbers {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 10px;
  margin: 20px 0;
  flex-wrap: wrap;
}

.lotto-ball {
  background: #667eea;
  color: white;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 1.1rem;
}

.lotto-ball.bonus {
  background: #ff6b6b;
}

.bonus-text {
  font-size: 1.5rem;
  color: #666;
  margin: 0 10px;
}

.lotto-text {
  font-size: 1.1rem;
  color: #333;
  margin-top: 15px;
}
  </style>
</head>
<body>
  <div class="header">
    <h1>Memory</h1>
  </div>
  <div class="container">
    <div id="mainMenu" class="main-menu">
      <div class="menu-grid">
        <button class="fortune-btn" onclick="showFortune()">
          <div class="btn-content">
            <span class="btn-icon">ğŸ”®</span>
            <span class="btn-text">ì˜¤ëŠ˜ì˜ ìš´ì„¸</span>
          </div>
        </button>
        <button class="lotto-btn" onclick="showLotto()">
          <div class="btn-content">
            <span class="btn-icon">ğŸ°</span>
            <span class="btn-text">Lotto</span>
          </div>
        </button>
      </div>
    </div>
    <div id="backBtn" class="back-button" style="display: none;">
      <button onclick="goBack()">â† ë’¤ë¡œ ê°€ê¸°</button>
    </div>
    <div id="result" class="result-box"></div>
  </div>
  <div class="visitor-counter">
    <span>ì˜¤ëŠ˜ ë°©ë¬¸ì: <span id="visitorCount">0</span>ëª…</span>
  </div>

  <!-- íšŒì›ê°€ì… ëª¨ë‹¬ -->
  <div id="registerModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 40px; border-radius: 20px; width: 450px; max-width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
      <h2 style="text-align: center; margin-bottom: 30px; color: #333; font-size: 1.8rem;">ğŸ“§ íšŒì›ê°€ì…</h2>
      <div style="margin-bottom: 25px;">
        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #555;">ì´ë©”ì¼ ì£¼ì†Œ</label>
        <div style="display: flex; gap: 8px; align-items: center;">
          <input type="text" id="emailLocal" placeholder="ì´ë©”ì¼" style="flex: 1; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; transition: border-color 0.3s;">
          <span style="font-size: 20px; color: #666; font-weight: bold;">@</span>
          <select id="emailDomain" style="flex: 1; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
            <option value="gmail.com">gmail.com</option>
            <option value="naver.com">naver.com</option>
            <option value="daum.net">daum.net</option>
            <option value="kakao.com">kakao.com</option>
            <option value="yahoo.com">yahoo.com</option>
            <option value="outlook.com">outlook.com</option>
            <option value="custom">ì§ì ‘ì…ë ¥</option>
          </select>
        </div>
        <input type="text" id="customDomain" placeholder="ë„ë©”ì¸ ì§ì ‘ì…ë ¥" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; margin-top: 8px; display: none; font-size: 14px;">
      </div>
      <div style="text-align: center; margin-top: 30px;">
        <button onclick="sendVerificationCode()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 14px 35px; border-radius: 25px; cursor: pointer; margin-right: 15px; font-size: 15px; font-weight: 600; transition: transform 0.2s;">ì¸ì¦ë²ˆí˜¸ ë°œì†¡</button>
        <button onclick="closeRegisterModal()" style="background: #95a5a6; color: white; border: none; padding: 14px 35px; border-radius: 25px; cursor: pointer; font-size: 15px; font-weight: 600; transition: transform 0.2s;">ì·¨ì†Œ</button>
      </div>
    </div>
  </div>

  <!-- ë¡œê·¸ì¸ ëª¨ë‹¬ -->
  <div id="loginModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 40px; border-radius: 20px; width: 450px; max-width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
      <h2 style="text-align: center; margin-bottom: 30px; color: #333; font-size: 1.8rem;">ğŸ”‘ ë¡œê·¸ì¸</h2>
      <div style="margin-bottom: 20px;">
        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #555;">ì´ë©”ì¼ ì£¼ì†Œ</label>
        <div style="display: flex; gap: 8px; align-items: center;">
          <input type="text" id="loginEmailLocal" placeholder="ì´ë©”ì¼" style="flex: 1; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
          <span style="font-size: 20px; color: #666; font-weight: bold;">@</span>
          <select id="loginEmailDomain" style="flex: 1; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
            <option value="gmail.com">gmail.com</option>
            <option value="naver.com">naver.com</option>
            <option value="daum.net">daum.net</option>
            <option value="kakao.com">kakao.com</option>
            <option value="yahoo.com">yahoo.com</option>
            <option value="outlook.com">outlook.com</option>
            <option value="custom">ì§ì ‘ì…ë ¥</option>
          </select>
        </div>
        <input type="text" id="loginCustomDomain" placeholder="ë„ë©”ì¸ ì§ì ‘ì…ë ¥" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; margin-top: 8px; display: none; font-size: 14px;">
      </div>
      <div style="margin-bottom: 25px;">
        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #555;">ë¹„ë°€ë²ˆí˜¸ (4ìë¦¬)</label>
        <input type="password" id="loginPassword" placeholder="4ìë¦¬ ë¹„ë°€ë²ˆí˜¸" maxlength="4" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; text-align: center; letter-spacing: 3px;">
      </div>
      <div style="text-align: center; margin-top: 30px;">
        <button onclick="processLogin()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 14px 35px; border-radius: 25px; cursor: pointer; margin-right: 15px; font-size: 15px; font-weight: 600;">ë¡œê·¸ì¸</button>
        <button onclick="closeLoginModal()" style="background: #95a5a6; color: white; border: none; padding: 14px 35px; border-radius: 25px; cursor: pointer; font-size: 15px; font-weight: 600;">ì·¨ì†Œ</button>
      </div>
    </div>
  </div>

  <!-- ì¸ì¦ë²ˆí˜¸ ì…ë ¥ ëª¨ë‹¬ -->
  <div id="verificationModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 40px; border-radius: 20px; width: 400px; max-width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.3); text-align: center;">
      <h2 style="margin-bottom: 20px; color: #333; font-size: 1.6rem;">ğŸ“± ì¸ì¦ë²ˆí˜¸ ì…ë ¥</h2>
      <p style="color: #666; margin-bottom: 25px; line-height: 1.5;">ì´ë©”ì¼ë¡œ ë°œì†¡ëœ 6ìë¦¬ ì¸ì¦ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
      <input type="text" id="verificationInput" placeholder="000000" maxlength="6" style="width: 200px; padding: 15px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 24px; text-align: center; letter-spacing: 5px; margin-bottom: 25px;">
      <div>
        <button onclick="verifyCode()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 14px 30px; border-radius: 25px; cursor: pointer; margin-right: 15px; font-size: 15px; font-weight: 600;">í™•ì¸</button>
        <button onclick="closeVerificationModal()" style="background: #95a5a6; color: white; border: none; padding: 14px 30px; border-radius: 25px; cursor: pointer; font-size: 15px; font-weight: 600;">ì·¨ì†Œ</button>
      </div>
    </div>
  </div>

  <!-- ì•Œë¦¼ ëª¨ë‹¬ -->
  <div id="alertModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1001;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; width: 350px; max-width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.3); text-align: center;">
      <div id="alertIcon" style="font-size: 3rem; margin-bottom: 15px;"></div>
      <div id="alertMessage" style="color: #333; margin-bottom: 25px; line-height: 1.5; font-size: 16px;"></div>
      <button onclick="closeAlert()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 30px; border-radius: 25px; cursor: pointer; font-size: 15px; font-weight: 600;">í™•ì¸</button>
    </div>
  </div>

  <div class="login-box" style="text-align:center; margin:20px;">
    <button onclick="showRegisterModal()">íšŒì›ê°€ì…</button>
    <button onclick="loginWithEmail()">ë¡œê·¸ì¸</button>
  </div>

<script>
  // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ê¸°ë°˜ ì‹œìŠ¤í…œ

  let pendingEmail = null;
  let verificationCode = null;
  let currentUser = null;

  // ìš´ì„¸ ê¸°ëŠ¥
  function showFortune() {
    document.getElementById('mainMenu').style.display = 'none';
    document.getElementById('backBtn').style.display = 'block';
    
    const fortunes = [
      'ì˜¤ëŠ˜ì€ ì¢‹ì€ ì¼ì´ ìƒê¸¸ ê²ƒì…ë‹ˆë‹¤! ğŸ€',
      'ìƒˆë¡œìš´ ê¸°íšŒê°€ ì°¾ì•„ì˜¬ ì˜ˆì •ì…ë‹ˆë‹¤ âœ¨',
      'ì‚¬ë‘í•˜ëŠ” ì‚¬ëŒê³¼ ì¢‹ì€ ì‹œê°„ì„ ë³´ë‚´ì„¸ìš” ğŸ’•',
      'ê±´ê°•ì— ì£¼ì˜í•˜ì‹œê³  ì¶©ë¶„í•œ íœ´ì‹ì„ ì·¨í•˜ì„¸ìš” ğŸŒ™',
      'ê¸ˆì „ìš´ì´ ìƒìŠ¹í•˜ê³  ìˆìŠµë‹ˆë‹¤ ğŸ’°',
      'ì°½ì˜ì ì¸ ì•„ì´ë””ì–´ê°€ ë– ì˜¤ë¥¼ ê²ƒì…ë‹ˆë‹¤ ğŸ’¡'
    ];
    
    const randomFortune = fortunes[Math.floor(Math.random() * fortunes.length)];
    document.getElementById('result').innerHTML = `
      <div class="fortune-result">
        <h2>ğŸ”® ì˜¤ëŠ˜ì˜ ìš´ì„¸</h2>
        <p class="fortune-text">${randomFortune}</p>
        <div class="fortune-date">${new Date().toLocaleDateString('ko-KR')}</div>
      </div>
    `;
  }

  // ë¡œë˜ ê¸°ëŠ¥
  function showLotto() {
    document.getElementById('mainMenu').style.display = 'none';
    document.getElementById('backBtn').style.display = 'block';
    
    const numbers = [];
    while(numbers.length < 6) {
      const num = Math.floor(Math.random() * 45) + 1;
      if(!numbers.includes(num)) {
        numbers.push(num);
      }
    }
    numbers.sort((a, b) => a - b);
    
    const bonus = Math.floor(Math.random() * 45) + 1;
    
    document.getElementById('result').innerHTML = `
      <div class="lotto-result">
        <h2>ğŸ° ë¡œë˜ ë²ˆí˜¸ ì¶”ì²œ</h2>
        <div class="lotto-numbers">
          ${numbers.map(num => `<span class="lotto-ball">${num}</span>`).join('')}
          <span class="bonus-text">+</span>
          <span class="lotto-ball bonus">${bonus}</span>
        </div>
        <p class="lotto-text">í–‰ìš´ì„ ë¹•ë‹ˆë‹¤! ğŸ€</p>
      </div>
    `;
  }

  // ë’¤ë¡œ ê°€ê¸°
  function goBack() {
    document.getElementById('mainMenu').style.display = 'block';
    document.getElementById('backBtn').style.display = 'none';
    document.getElementById('result').innerHTML = '';
  }

  // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ë¡œ ë°©ë¬¸ì ìˆ˜ ê´€ë¦¬
  function updateVisitorCount() {
    const today = new Date().toDateString();
    const lastVisit = localStorage.getItem('lastVisit');
    let count = parseInt(localStorage.getItem('visitorCount') || '0');
    
    if (lastVisit !== today) {
      count = 1;
      localStorage.setItem('lastVisit', today);
    } else {
      count++;
    }
    
    localStorage.setItem('visitorCount', count.toString());
    document.getElementById('visitorCount').textContent = count;
  }

  // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ë°©ë¬¸ì ìˆ˜ ë™ê¸°í™” (ë‹¨ìˆœ í‘œì‹œ)
  function syncVisitorCount() {
    const count = localStorage.getItem('visitorCount') || '0';
    document.getElementById('visitorCount').textContent = count;
  }

  // íšŒì›ê°€ì… ëª¨ë‹¬ í‘œì‹œ
  function showRegisterModal() {
    document.getElementById('registerModal').style.display = 'block';
  }

  // íšŒì›ê°€ì… ëª¨ë‹¬ ë‹«ê¸°
  function closeRegisterModal() {
    document.getElementById('registerModal').style.display = 'none';
    document.getElementById('emailLocal').value = '';
    document.getElementById('emailDomain').value = 'gmail.com';
    document.getElementById('customDomain').style.display = 'none';
  }



  // ì¸ì¦ë²ˆí˜¸ ë°œì†¡
  function sendVerificationCode() {
    try {
      console.log('ì¸ì¦ë²ˆí˜¸ ë°œì†¡ ì‹œì‘');
      
      const emailLocal = document.getElementById('emailLocal');
      const emailDomain = document.getElementById('emailDomain');
      const customDomain = document.getElementById('customDomain');
      
      if (!emailLocal || !emailDomain) {
        console.error('ì´ë©”ì¼ ì…ë ¥ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        showAlert('âŒ', 'í˜ì´ì§€ ë¡œë“œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        return;
      }
      
      const emailLocalValue = emailLocal.value.trim();
      const emailDomainValue = emailDomain.value;
      const customDomainValue = customDomain ? customDomain.value.trim() : '';
      
      console.log('ì´ë©”ì¼ ì…ë ¥ê°’:', emailLocalValue, emailDomainValue, customDomainValue);
      
      if (!emailLocalValue) {
        showAlert('âš ï¸', 'ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      const domain = emailDomainValue === 'custom' ? customDomainValue : emailDomainValue;
      if (!domain) {
        showAlert('âš ï¸', 'ë„ë©”ì¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      const email = `${emailLocalValue}@${domain}`;
      console.log('ì™„ì„±ëœ ì´ë©”ì¼:', email);
      
      // ì´ë©”ì¼ í˜•ì‹ ê²€ì¦
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        showAlert('âš ï¸', 'ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.');
        return;
      }

      // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ì¤‘ë³µ í™•ì¸
      const localUsers = JSON.parse(localStorage.getItem('localUsers') || '[]');
      console.log('ê¸°ì¡´ ì‚¬ìš©ì ìˆ˜:', localUsers.length);
      
      if (localUsers.find(user => user.email === email)) {
        showAlert('âš ï¸', 'ì´ë¯¸ ê°€ì…ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤.');
        return;
      }

      // ì¸ì¦ë²ˆí˜¸ ìƒì„±
      verificationCode = Math.floor(100000 + Math.random() * 900000).toString();
      pendingEmail = email;

      console.log(`ì¸ì¦ë²ˆí˜¸ ìƒì„± ì™„ë£Œ: ${verificationCode}`);
      
      closeRegisterModal();
      showAlert('ğŸ“±', `ì¸ì¦ë²ˆí˜¸ê°€ ${email}ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.\n\nê°œë°œìš©: ${verificationCode}`);
      
      setTimeout(() => {
        closeAlert();
        continueRegistration();
      }, 2000);
      
    } catch (error) {
      console.error('ì¸ì¦ë²ˆí˜¸ ë°œì†¡ ì˜¤ë¥˜:', error);
      showAlert('âŒ', 'ì¸ì¦ë²ˆí˜¸ ë°œì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
  }

  // ì¸ì¦ë²ˆí˜¸ ì…ë ¥ ëª¨ë‹¬ í‘œì‹œ
  function continueRegistration() {
    document.getElementById('verificationModal').style.display = 'block';
    document.getElementById('verificationInput').focus();
  }

  // ì¸ì¦ë²ˆí˜¸ ëª¨ë‹¬ ë‹«ê¸°
  function closeVerificationModal() {
    document.getElementById('verificationModal').style.display = 'none';
    document.getElementById('verificationInput').value = '';
    resetRegistration();
  }

  // ì¸ì¦ë²ˆí˜¸ í™•ì¸
  function verifyCode() {
    try {
      const inputCode = document.getElementById('verificationInput').value.trim();
      
      if (!inputCode) {
        showAlert('âš ï¸', 'ì¸ì¦ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      if (inputCode !== verificationCode) {
        showAlert('âŒ', 'ì¸ì¦ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
        return;
      }

      closeVerificationModal();
      completeRegistration();
      
    } catch (error) {
      console.error('ì¸ì¦ë²ˆí˜¸ í™•ì¸ ì˜¤ë¥˜:', error);
      showAlert('âŒ', 'ì¸ì¦ë²ˆí˜¸ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
  }

  // íšŒì›ê°€ì… ì™„ë£Œ
  function completeRegistration() {
    const password = prompt('4ìë¦¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•˜ì„¸ìš”:');
    if (!password || password.length !== 4) {
      showAlert('âš ï¸', '4ìë¦¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
      resetRegistration();
      return;
    }

    const nickname = prompt('ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”:');
    if (!nickname) {
      showAlert('âš ï¸', 'ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      resetRegistration();
      return;
    }

    // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì‚¬ìš©ì ì €ì¥
    const localUsers = JSON.parse(localStorage.getItem('localUsers') || '[]');
    const newUser = {
      id: Date.now().toString(),
      email: pendingEmail,
      password: password,
      nickname: nickname,
      createdAt: new Date().toISOString()
    };
    localUsers.push(newUser);
    localStorage.setItem('localUsers', JSON.stringify(localUsers));

    showAlert('ğŸ‰', `${nickname}ë‹˜, íšŒì›ê°€ì… ì™„ë£Œ!`);
    resetRegistration();
    updateLoginUI();
  }

  // íšŒì›ê°€ì… ìƒíƒœ ì´ˆê¸°í™”
  function resetRegistration() {
    pendingEmail = null;
    verificationCode = null;
  }

  // ë¡œê·¸ì¸ ëª¨ë‹¬ í‘œì‹œ
  function showLoginModal() {
    document.getElementById('loginModal').style.display = 'block';
  }

  // ë¡œê·¸ì¸ ëª¨ë‹¬ ë‹«ê¸°
  function closeLoginModal() {
    document.getElementById('loginModal').style.display = 'none';
    document.getElementById('loginEmailLocal').value = '';
    document.getElementById('loginEmailDomain').value = 'gmail.com';
    document.getElementById('loginPassword').value = '';
    document.getElementById('loginCustomDomain').style.display = 'none';
  }

  // ë¡œê·¸ì¸ ì²˜ë¦¬
  function processLogin() {
    try {
      const emailLocal = document.getElementById('loginEmailLocal').value.trim();
      const emailDomain = document.getElementById('loginEmailDomain').value;
      const customDomain = document.getElementById('loginCustomDomain').value.trim();
      const password = document.getElementById('loginPassword').value.trim();

      if (!emailLocal) {
        showAlert('âš ï¸', 'ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      const domain = emailDomain === 'custom' ? customDomain : emailDomain;
      if (!domain) {
        showAlert('âš ï¸', 'ë„ë©”ì¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      if (!password || password.length !== 4) {
        showAlert('âš ï¸', '4ìë¦¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      const email = `${emailLocal}@${domain}`;

      // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ì‚¬ìš©ì ì°¾ê¸°
      const localUsers = JSON.parse(localStorage.getItem('localUsers') || '[]');
      const user = localUsers.find(u => u.email === email && u.password === password);

      if (!user) {
        showAlert('âŒ', 'ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
        return;
      }

      currentUser = {
        id: user.id,
        email: user.email,
        nickname: user.nickname
      };

      // ë¡œê·¸ì¸ ì‹œê°„ ê¸°ë¡
      user.lastLogin = new Date().toISOString();
      localStorage.setItem('localUsers', JSON.stringify(localUsers));

      closeLoginModal();
      showAlert('ğŸ‰', `${currentUser.nickname}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!`);
      updateLoginUI();
      
    } catch (error) {
      console.error('ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜:', error);
      showAlert('âŒ', 'ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
  }

  // ë¡œê·¸ì•„ì›ƒ
  function logout() {
    currentUser = null;
    showAlert('ğŸ‘‹', 'ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ!');
    updateLoginUI();
  }

  // ì•Œë¦¼ ëª¨ë‹¬ í‘œì‹œ
  function showAlert(icon, message) {
    document.getElementById('alertIcon').textContent = icon;
    document.getElementById('alertMessage').textContent = message;
    document.getElementById('alertModal').style.display = 'block';
  }

  // ì•Œë¦¼ ëª¨ë‹¬ ë‹«ê¸°
  function closeAlert() {
    document.getElementById('alertModal').style.display = 'none';
  }

  // ë¡œê·¸ì¸ UI ì—…ë°ì´íŠ¸
  function updateLoginUI() {
    const box = document.querySelector(".login-box");
    if (currentUser) {
      box.innerHTML = `
        <p>ğŸ‰ ${currentUser.nickname}ë‹˜ ë¡œê·¸ì¸ ì¤‘</p>
        <button onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>`;
    } else {
      box.innerHTML = `
        <button onclick="showRegisterModal()">íšŒì›ê°€ì…</button>
        <button onclick="showLoginModal()">ë¡œê·¸ì¸</button>`;
    }
  }

  document.addEventListener('DOMContentLoaded', function() {
    updateLoginUI();
    updateVisitorCount();
    syncVisitorCount();
    
    console.log('ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ê¸°ë°˜ ì‹œìŠ¤í…œ ì‹œì‘');
    
    // ë„ë©”ì¸ ì„ íƒ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (íšŒì›ê°€ì…)
    const domainSelect = document.getElementById('emailDomain');
    const customDomain = document.getElementById('customDomain');
    
    if (domainSelect) {
      domainSelect.addEventListener('change', function() {
        if (this.value === 'custom') {
          customDomain.style.display = 'block';
        } else {
          customDomain.style.display = 'none';
        }
      });
    }

    // ë„ë©”ì¸ ì„ íƒ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (ë¡œê·¸ì¸)
    const loginDomainSelect = document.getElementById('loginEmailDomain');
    const loginCustomDomain = document.getElementById('loginCustomDomain');
    
    if (loginDomainSelect) {
      loginDomainSelect.addEventListener('change', function() {
        if (this.value === 'custom') {
          loginCustomDomain.style.display = 'block';
        } else {
          loginCustomDomain.style.display = 'none';
        }
      });
    }

    // ì¸ì¦ë²ˆí˜¸ ì…ë ¥ ì‹œ ìë™ ì´ë™
    const verificationInput = document.getElementById('verificationInput');
    if (verificationInput) {
      verificationInput.addEventListener('input', function() {
        if (this.value.length === 6) {
          setTimeout(() => verifyCode(), 500);
        }
      });
    }
  });
</script>
</body>
</html>

